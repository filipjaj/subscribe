# Project Structure

Feature-based architecture scales better than type-based (separate folders for hooks, components, etc.).

## Recommended Structure

```
src/
├── app/                        # Global app configuration
│   ├── router.tsx              # createRouter, RouterContext
│   ├── providers.tsx           # QueryClientProvider, JotaiProvider
│   └── client.tsx              # Entry point
│
├── routes/                     # TanStack File Routes
│   ├── __root.tsx              # Root layout
│   ├── index.tsx               # Home page
│   ├── _authenticated.tsx      # Auth layout (pathless)
│   ├── _authenticated/
│   │   ├── dashboard.tsx       # /dashboard
│   │   └── settings.tsx        # /settings
│   ├── posts.tsx               # /posts layout
│   ├── posts/
│   │   ├── index.tsx           # /posts (list)
│   │   └── $postId.tsx         # /posts/:id
│   └── api/
│       └── auth/
│           └── $.ts            # BetterAuth handler
│
├── features/                   # Feature modules (colocation!)
│   ├── auth/
│   │   ├── components/
│   │   │   ├── login-form.tsx
│   │   │   └── signup-form.tsx
│   │   ├── hooks/
│   │   │   └── use-auth.ts
│   │   └── server-fns.ts
│   │
│   ├── posts/
│   │   ├── components/
│   │   │   ├── post-card.tsx
│   │   │   ├── post-list.tsx
│   │   │   └── create-post-form.tsx
│   │   ├── hooks/
│   │   │   ├── use-posts.ts
│   │   │   └── use-create-post.ts
│   │   ├── posts.queries.ts    # queryOptions
│   │   ├── posts.store.ts      # Jotai atoms
│   │   └── server-fns.ts       # createServerFn
│   │
│   └── shared/                 # Cross-feature utilities
│       ├── ui/                 # Shadcn/ui components
│       │   ├── button.tsx
│       │   └── input.tsx
│       └── utils/
│           └── format-date.ts
│
├── lib/                        # Third-party configurations
│   ├── auth.ts                 # BetterAuth server config
│   ├── auth-client.ts          # BetterAuth client
│   ├── db.ts                   # Prisma client
│   ├── query-client.ts         # TanStack Query config
│   └── utils.ts                # cn() helper, etc.
│
└── routeTree.gen.ts            # Auto-generated by TanStack
```

## Key Principles

### Routes Should Be Thin

Routes only define: `loader`, `validateSearch`, `beforeLoad`, and import a component.

```tsx
// routes/posts/$postId.tsx
import { createFileRoute } from '@tanstack/react-router'
import { postQueryOptions } from '@/features/posts/posts.queries'
import { PostDetail } from '@/features/posts/components/post-detail'

export const Route = createFileRoute('/posts/$postId')({
  loader: ({ context, params }) =>
    context.queryClient.ensureQueryData(postQueryOptions(params.postId)),
  component: PostDetail,
})
```

### Feature Colocation

Everything related to "posts" lives in `features/posts/`:

```
features/posts/
├── components/         # UI components
├── hooks/              # Custom hooks
├── posts.queries.ts    # TanStack Query options
├── posts.store.ts      # Jotai atoms
├── schemas.ts          # Zod schemas (shared)
└── server-fns.ts       # Server functions
```

### Naming Conventions

| File            | Purpose                        |
| --------------- | ------------------------------ |
| `*.queries.ts`  | TanStack Query options         |
| `*.store.ts`    | Jotai atoms                    |
| `server-fns.ts` | Server functions               |
| `schemas.ts`    | Zod schemas                    |
| `*.server.ts`   | Server-only helpers (DB logic) |

### Shared UI Components

Use `features/shared/ui/` for Shadcn components. Import with alias:

```tsx
import { Button } from '@/features/shared/ui/button'
```

### Excluded Files (Colocated Helpers)

Prefix with `-` to exclude from route generation:

```
routes/
├── posts.tsx
├── -posts-helpers.ts    # Not a route
└── -components/         # Not routes
    └── post-card.tsx
```

## File Templates

### Query Options

```tsx
// features/posts/posts.queries.ts
import { queryOptions } from '@tanstack/react-query'
import { getPostsFn, getPostFn } from './server-fns'

export const postsQueryOptions = queryOptions({
  queryKey: ['posts'],
  queryFn: () => getPostsFn(),
})

export const postQueryOptions = (id: string) =>
  queryOptions({
    queryKey: ['posts', id],
    queryFn: () => getPostFn({ data: { id } }),
  })
```

### Jotai Store

```tsx
// features/posts/posts.store.ts
import { atom } from 'jotai'

export const postSearchAtom = atom('')
export const postFilterAtom = atom<'all' | 'published' | 'draft'>('all')
```

### Hook Pattern

```tsx
// features/posts/hooks/use-posts.ts
import { atom, useAtom } from 'jotai'
import { useSuspenseQuery } from '@tanstack/react-query'
import { postsQueryOptions } from '../posts.queries'
import { postSearchAtom } from '../posts.store'

export function usePosts() {
  const { data: posts } = useSuspenseQuery(postsQueryOptions)
  const [search, setSearch] = useAtom(postSearchAtom)

  const filteredPosts = posts.filter((post) =>
    post.title.toLowerCase().includes(search.toLowerCase()),
  )

  return {
    posts: filteredPosts,
    totalCount: posts.length,
    search,
    setSearch,
  }
}
```

## Path Aliases

Configure in `tsconfig.json`:

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

Usage:

```tsx
import { Button } from '@/features/shared/ui/button'
import { useCreatePost } from '@/features/posts/hooks/use-create-post'
import { auth } from '@/lib/auth'
```
